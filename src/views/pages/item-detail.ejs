<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Item Detail &amp; Responses - FindIt</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&amp;display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
      rel="stylesheet"
    />
    <script id="tailwind-config">
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#1754cf",
              "background-light": "#f6f6f8",
              "background-dark": "#111621",
              "neutral-50": "#f8f9fc",
              "neutral-100": "#e7ebf3",
              "neutral-200": "#d0d7e7",
              "neutral-300": "#aab6cf",
              "neutral-400": "#7c8eb3",
              "neutral-500": "#5a6f94",
              "neutral-900": "#0e121b"
            },
            fontFamily: {
              display: ["Manrope", "sans-serif"]
            },
            borderRadius: {
              DEFAULT: "0.5rem",
              lg: "1rem",
              xl: "1.5rem",
              "2xl": "2rem",
              full: "9999px"
            },
            boxShadow: {
              soft: "0 4px 20px -2px rgba(0, 0, 0, 0.05)"
            }
          }
        }
      };
    </script>
  </head>
  <body
    class="bg-background-light dark:bg-background-dark font-display text-neutral-900 dark:text-neutral-50 antialiased min-h-screen flex flex-col"
  >
    <% const gallery = images && images.length ? images : [{ image_url: notice.image_url }]; %>
    <%- include("../partials/navbar-main", { activePage: "listings", showCta: true }) %>
    <main class="flex-grow w-full max-w-[1280px] mx-auto px-6 py-8">
      <div class="flex items-center gap-2 text-sm text-neutral-500 mb-8">
        <a class="hover:text-primary transition-colors" href="/listings">Home</a>
        <span class="material-symbols-outlined text-[16px]">chevron_right</span>
        <span class="text-neutral-900 dark:text-neutral-100 font-medium"><%= notice.category %></span>
      </div>
      <div class="grid grid-cols-1 lg:grid-cols-[1fr_380px] gap-8 lg:gap-12">
        <div class="flex flex-col gap-8">
          <div class="space-y-4">
            <div class="flex items-start justify-between gap-4">
              <h1 class="text-3xl md:text-4xl font-bold text-neutral-900 dark:text-white leading-tight">
                <%= notice.title %>
              </h1>
              <button aria-label="Share" class="p-2 rounded-full hover:bg-neutral-100 dark:hover:bg-neutral-800 text-neutral-500 transition-colors">
                <span class="material-symbols-outlined">ios_share</span>
              </button>
            </div>
            <div class="flex items-center gap-2 text-neutral-500">
              <span class="material-symbols-outlined text-[18px]">location_on</span>
              <span><%= notice.location_text %></span>
            </div>
          </div>
          <div class="w-full aspect-video md:aspect-[16/10] overflow-hidden rounded-2xl bg-neutral-100 relative group">
            <img
              alt="Main item image"
              class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
              src="<%= gallery[0] ? gallery[0].image_url : '' %>"
            />
            <div class="absolute bottom-4 right-4 bg-black/50 backdrop-blur-sm text-white text-xs font-bold px-3 py-1.5 rounded-full flex items-center gap-1">
              <span class="material-symbols-outlined text-[14px]">photo_library</span>
              <%= gallery.length %>
            </div>
          </div>
          <div class="grid grid-cols-4 gap-4">
            <% gallery.slice(0, 4).forEach((image, index) => { %>
            <div class="aspect-square rounded-xl overflow-hidden cursor-pointer <%= index === 0 ? 'border-2 border-primary' : '' %>">
              <img class="w-full h-full object-cover" src="<%= image.image_url %>" alt="Gallery image" />
            </div>
            <% }) %>
          </div>
          <div class="border-t border-neutral-200 dark:border-neutral-800 pt-8">
            <h3 class="text-xl font-bold mb-4">About this item</h3>
            <div class="prose prose-neutral dark:prose-invert max-w-none text-neutral-600 dark:text-neutral-300 leading-relaxed">
              <p><%= notice.description %></p>
            </div>
          </div>
          <div class="border-t border-neutral-200 dark:border-neutral-800 pt-8 mt-4">
            <div class="flex items-center justify-between mb-6">
              <h3 class="text-xl font-bold">Responses</h3>
              <span class="bg-primary/10 text-primary text-xs font-bold px-2.5 py-1 rounded-full">
                <%= responses.length %> Total
              </span>
            </div>
            <div class="bg-white dark:bg-neutral-800 rounded-2xl border border-neutral-200 dark:border-neutral-700 overflow-hidden shadow-soft">
              <div class="max-h-[400px] overflow-y-auto p-6 space-y-6 bg-neutral-50/50 dark:bg-neutral-900/20">
                <% responses.forEach((response) => { %>
                <% const name = response.user_name || "User"; %>
                <% const initials = name.split(" ").map((word) => word[0]).slice(0, 2).join("").toUpperCase(); %>
                <div class="flex gap-4">
                  <div class="size-10 rounded-full bg-orange-100 flex items-center justify-center text-orange-600 font-bold shrink-0">
                    <%= initials %>
                  </div>
                  <div class="flex-1">
                    <div class="flex items-baseline justify-between mb-1">
                      <span class="font-bold text-sm"><%= name %></span>
                      <span class="text-xs text-neutral-400"><%= response.created_at %></span>
                    </div>
                    <div class="bg-white dark:bg-neutral-700 p-4 rounded-2xl rounded-tl-none border border-neutral-100 dark:border-neutral-600 shadow-sm text-sm text-neutral-700 dark:text-neutral-200">
                      <%= response.message %>
                    </div>
                  </div>
                </div>
                <% }) %>
              </div>
              <div class="p-4 bg-white dark:bg-neutral-800 border-t border-neutral-100 dark:border-neutral-700">
                <% if (responseError) { %>
                  <div class="mb-3 text-sm text-red-600 bg-red-50 border border-red-200 px-3 py-2 rounded-lg">
                    <%= responseError %>
                  </div>
                <% } %>
                <form class="relative" method="POST" action="/items/<%= notice.id %>/responses">
                  <textarea
                    name="message"
                    class="w-full pl-4 pr-12 py-3 bg-neutral-100 dark:bg-neutral-900 rounded-xl resize-none focus:ring-2 focus:ring-primary/50 focus:bg-white dark:focus:bg-black transition-all border-none placeholder-neutral-400 text-sm"
                    placeholder="Send a message..."
                    rows="1"
                    required
                  ></textarea>
                  <button type="submit" class="absolute right-2 top-1/2 -translate-y-1/2 p-2 text-primary hover:bg-primary/10 rounded-lg transition-colors">
                    <span class="material-symbols-outlined text-[20px] fill-1">send</span>
                  </button>
                </form>
                <p class="text-xs text-neutral-400 mt-2 flex items-center gap-1">
                  <span class="material-symbols-outlined text-[14px]">lock</span>
                  Your message will be private until the owner replies.
                </p>
              </div>
            </div>
          </div>
        </div>
        <div class="space-y-6">
          <div class="bg-white dark:bg-neutral-800 rounded-2xl p-6 border border-neutral-200 dark:border-neutral-700 shadow-soft">
            <div class="flex items-center justify-between mb-6 pb-6 border-b border-neutral-100 dark:border-neutral-700">
              <div>
                <p class="text-sm font-medium text-neutral-500 mb-1">Status</p>
                <div class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-sm font-bold
                  <%= notice.type === 'lost'
                    ? 'bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400'
                    : 'bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400' %>">
                  <span class="size-2 rounded-full <%= notice.type === 'lost' ? 'bg-red-500' : 'bg-green-500' %> animate-pulse"></span>
                  <%= notice.type === "lost" ? "Lost" : "Found" %>
                </div>
              </div>
              <div class="text-right">
                <p class="text-sm font-medium text-neutral-500 mb-1">Reward</p>
                <p class="text-lg font-bold text-neutral-900 dark:text-white">
                  <%= notice.reward_amount ? "$" + Number(notice.reward_amount).toFixed(2) : "-" %>
                </p>
              </div>
            </div>
            <div class="space-y-5">
              <div class="flex gap-3 items-start">
                <div class="mt-0.5 p-2 bg-neutral-100 dark:bg-neutral-700 rounded-lg text-neutral-600 dark:text-neutral-300">
                  <span class="material-symbols-outlined text-[20px]">calendar_today</span>
                </div>
                <div>
                  <p class="text-xs font-bold text-neutral-500 uppercase tracking-wide">Date</p>
                  <p class="text-neutral-900 dark:text-white font-medium"><%= notice.occurred_at %></p>
                </div>
              </div>
              <div class="flex gap-3 items-start">
                <div class="mt-0.5 p-2 bg-neutral-100 dark:bg-neutral-700 rounded-lg text-neutral-600 dark:text-neutral-300">
                  <span class="material-symbols-outlined text-[20px]">category</span>
                </div>
                <div>
                  <p class="text-xs font-bold text-neutral-500 uppercase tracking-wide">Category</p>
                  <p class="text-neutral-900 dark:text-white font-medium"><%= notice.category %></p>
                  <% if (notice.subcategory) { %>
                  <p class="text-sm text-neutral-500"><%= notice.subcategory %></p>
                  <% } %>
                </div>
              </div>
              <div class="flex gap-3 items-start">
                <div class="mt-0.5 p-2 bg-neutral-100 dark:bg-neutral-700 rounded-lg text-neutral-600 dark:text-neutral-300">
                  <span class="material-symbols-outlined text-[20px]">fingerprint</span>
                </div>
                <div>
                  <p class="text-xs font-bold text-neutral-500 uppercase tracking-wide">Item ID</p>
                  <p class="text-neutral-900 dark:text-white font-medium font-mono text-sm">
                    #FND-<%= notice.id %>
                  </p>
                </div>
              </div>
            </div>
            <div class="mt-8 pt-6 border-t border-neutral-100 dark:border-neutral-700">
              <div class="flex items-center gap-4 mb-4">
                <% if (owner.avatar_url) { %>
                <img
                  alt="Owner avatar"
                  class="size-12 rounded-full object-cover ring-2 ring-white dark:ring-neutral-800"
                  src="<%= owner.avatar_url %>"
                />
                <% } else { %>
                <div class="size-12 rounded-full bg-primary/10 text-primary flex items-center justify-center text-lg font-bold ring-2 ring-white dark:ring-neutral-800">
                  <%= owner.name ? owner.name[0].toUpperCase() : "?" %>
                </div>
                <% } %>
                <div>
                  <p class="font-bold text-neutral-900 dark:text-white"><%= owner.name %></p>
                  <div class="flex items-center gap-1 text-xs text-neutral-500">
                    <span class="material-symbols-outlined text-[14px] text-green-500">verified</span>
                    Verified User
                  </div>
                </div>
              </div>
              <button
                class="w-full bg-primary hover:bg-primary/90 text-white font-bold py-3 px-4 rounded-xl shadow-lg shadow-primary/20 transition-all active:scale-[0.98] flex items-center justify-center gap-2"
              >
                <span class="material-symbols-outlined">chat_bubble</span>
                Contact Owner
              </button>
              <button
                class="w-full mt-3 bg-white dark:bg-transparent border border-neutral-200 dark:border-neutral-600 hover:bg-neutral-50 dark:hover:bg-neutral-800 text-neutral-900 dark:text-white font-bold py-3 px-4 rounded-xl transition-all active:scale-[0.98]"
              >
                Print Flyer
              </button>
            </div>
          </div>
          <div class="rounded-2xl overflow-hidden border border-neutral-200 dark:border-neutral-700 h-48 relative group cursor-pointer">
            <img
              alt="Map"
              class="w-full h-full object-cover"
              src="https://lh3.googleusercontent.com/aida-public/AB6AXuAwsGurXI1Ck7ACxEqwHmcUNfh0bLOchtCZv-SGK1PwArmAqLDdWav9q6FQWtK-ZoVcWqqR7YdPfRuUUU1_MzPY5xad6-3aDp-S9r5l-zeV8PpXYOjDfSrsBalta_eqNnzowMFmWb-6wvyXrsHN2V3RdQCfBvtG1zyZyvrLq1PK1BCBFQYQhhpg28S41McvtAmSzyncDAuTigClVgY7WHrqghES7fv8CoZfW2cQkz15jNsLmc9iUztpo__tZiOxLXcxifeGt6CWnmmW"
            />
            <div class="absolute inset-0 bg-black/10 group-hover:bg-black/20 transition-colors flex items-center justify-center">
              <span class="bg-white dark:bg-neutral-900 text-neutral-900 dark:text-white px-4 py-2 rounded-lg text-sm font-bold shadow-lg transform translate-y-2 group-hover:translate-y-0 transition-transform">
                View Map
              </span>
            </div>
          </div>
        </div>
      </div>
    </main>
    <footer class="mt-12 border-t border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-900 py-12">
      <div class="max-w-[1280px] mx-auto px-6">
        <div class="flex flex-col md:flex-row justify-between items-center gap-6">
          <div class="flex items-center gap-2 text-neutral-900 dark:text-white">
            <div class="size-6 rounded bg-primary flex items-center justify-center text-white">
              <span class="material-symbols-outlined text-[14px]">search</span>
            </div>
            <span class="font-bold text-lg">FindIt</span>
          </div>
          <div class="flex gap-8 text-sm text-neutral-500">
            <a class="hover:text-primary transition-colors" href="/privacy">Privacy Policy</a>
            <a class="hover:text-primary transition-colors" href="/terms">Terms of Service</a>
            <a class="hover:text-primary transition-colors" href="/about">Safety Tips</a>
          </div>
          <p class="text-sm text-neutral-400">Â© 2023 FindIt Inc. All rights reserved.</p>
        </div>
      </div>
    </footer>
  </body>
</html>